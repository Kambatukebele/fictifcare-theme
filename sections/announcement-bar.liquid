<section
  style="background-color: {{ section.settings.announcement_bg }}; color: {{ section.settings.announcement_text_color }}"
  class="w-full"
  animation-speed="{{ section.settings.announcement_animation | times: 1000  }}"
>
  <div class="container mx-auto {{ section.settings.announcement_height }} flex justify-center items-center relative">
    {% if section.blocks.size == 1 %}
      {% if section.blocks.first.settings.announcement_url != blank %}
        <a href="{{- section.blocks.first.settings.announcement_url -}}">
      {% endif %}
      <p class="text-sm {{ section.settings.announcement_text_decoration }} {% if section.blocks.size != 1 %} announcement {% endif %} absolute inset-0 flex items-center justify-center transform transition-all duration-700 ease-in-out opacity-100 translate-y-0 z-10">
        {{- section.blocks.first.settings.announcement_text -}}
      </p>
      {% if section.blocks.first.settings.announcement_url != blank %}
        </a>
      {% endif %}
    {% elsif section.blocks.size > 1 %}
      {% for block in section.blocks %}
        {%- case block.type -%}
          {%- when 'announcement' -%}
            {% if block.settings.announcement_url != blank %}
              <a href="{{- block.settings.announcement_url -}}">
            {% endif %}
            <p class="text-sm {{ section.settings.announcement_text_decoration }} announcement absolute inset-0 flex items-center justify-center transform transition-all duration-700 ease-in-out  {% if forloop.first %}  opacity-100 translate-y-0 z-10 {% else %} opacity-0 translate-y-4 z-0 pointer-events-none {% endif %}">
              {{- block.settings.announcement_text -}}
            </p>
            {% if block.settings.announcement_url != blank %}
              </a>
            {% endif %}
          {%- when '@app' -%}
        {%- endcase -%}
      {% endfor %}
    {% else %}
      {% for item in (1..3) %}
        <p class="text-sm {{ section.settings.announcement_text_decoration }} announcement absolute inset-0 flex items-center justify-center transform transition-all duration-700 ease-in-out  {% if forloop.first %}  opacity-100 translate-y-0 z-10 {% else %} opacity-0 translate-y-4 z-0 pointer-events-none {% endif %}">
          Welcome {{ forloop.index }}
        </p>
      {% endfor %}
    {% endif %}

    {% comment %}
      <p class="text-sm {{ section.settings.announcement_text_decoration }} announcement absolute inset-0 flex items-center justify-center transform transition-all duration-700 ease-in-out opacity-100 translate-y-0 z-10">
        Welcome one
      </p>
      <p class="text-sm {{ section.settings.announcement_text_decoration }} announcement absolute inset-0 flex items-center justify-center transform transition-all duration-700 ease-in-out opacity-0 translate-y-4 z-0 pointer-events-none">
        Welcome two
      </p>
      <p class="text-sm {{ section.settings.announcement_text_decoration }} announcement absolute inset-0 flex items-center justify-center transform transition-all duration-700 ease-in-out opacity-0 translate-y-4 z-0 pointer-events-none">
        Welcome three
      </p>
    {% endcomment %}
  </div>
</section>

<script>
  const items = document.querySelectorAll('.announcement');
  let current = 0;
  const elem = document.querySelector('section[animation-speed]');
  let speed = elem.getAttribute('animation-speed');

  function showIndex(i) {
    items.forEach((el, idx) => {
      if (idx === i) {
        el.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none', 'z-0');
        el.classList.add('opacity-100', 'translate-y-0', 'z-10');
      } else {
        el.classList.remove('opacity-100', 'translate-y-0', 'z-10');
        el.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none', 'z-0');
      }
    });
  }

  showIndex(current);

  setInterval(() => {
    current = (current + 1) % items.length;
    showIndex(current);
  }, speed);
</script>

{% schema %}
{
  "name": "Announcement bar",
  "class": "announcement_bar",
  "disabled_on": {
    "groups": ["footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Announcement colors"
    },
    {
      "type": "color",
      "id": "announcement_bg",
      "label": "Background",
      "default": "#000000",
      "info": "Background color of the announcement bar"
    },
    {
      "type": "color",
      "id": "announcement_text_color",
      "label": "Text color",
      "default": "#ffffff",
      "info": "Text color announcement bar"
    },
    {
      "type": "header",
      "content": "Announcement height"
    },
    {
      "type": "select",
      "id": "announcement_height",
      "label": "Announcement height",
      "options": [
        {
          "label": "32px",
          "value": "h-8"
        },
        {
          "label": "40px",
          "value": "h-10"
        },
        {
          "label": "48px",
          "value": "h-12"
        }
      ],
      "default": "h-8",
      "info": "Height of the announcement bar"
    },
    {
      "type": "header",
      "content": "Announcement text decoration"
    },
    {
      "type": "select",
      "id": "announcement_text_decoration",
      "label": "Text decoration",
      "options": [
        {
          "label": "Normal",
          "value": "normal-case"
        },
        {
          "label": "Uppercase",
          "value": "uppercase"
        },
        {
          "label": "Capitalize",
          "value": "capitalize"
        }
      ],
      "default": "normal-case",
      "info": "Your text decoration: normal, uppercase, capiralize"
    },
    {
      "type": "header",
      "content": "Animation settings"
    },
    {
      "type": "range",
      "id": "announcement_animation",
      "min": 3,
      "max": 10,
      "label": "Animation speed",
      "step": 1,
      "unit": "s",
      "default": 3,
      "info": "Animation announcement"
    }
  ],
  "tag": "section",
  "max_blocks": 3,
  "limit": 1,
  "blocks": [
    {
      "name": "Announcement",
      "type": "announcement",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "announcement_text",
          "label": "Announcement bar",
          "default": "Welcome to our store",
          "info": "Write your announcement here",
          "placeholder": "Write your announcement"
        },
        {
          "type": "url",
          "id": "announcement_url",
          "label": "Announcement URL",
          "info": "Add your url here"
        }
      ]
    },
    {
      "type": "@app"
    }
  ],
  "presets": [
    {
      "name": "Announcement bar",
      "settings": {
        "announcement_bg": "#000000",
        "announcement_text_color": "#ffffff",
        "announcement_height": "h-8",
        "announcement_text_decoration": "normal-case"
      },
      "blocks": [
        {
          "type": "announcement"
        }
      ]
    }
  ]
}
{% endschema %}
